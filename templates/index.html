<body>
  <template id="pageContent">
    <div class="container">
      <!-- ======= ORIGINAL CONTENT STARTS HERE ======= -->
      <div class="left-panel">
        <h1 class="title">Lab File Transfer</h1>
        <div class="info-section">
          <h2 class="info-title">No Login Required</h2>
          <p class="info-description">
            Transfer lab assignments from lab computers to your personal device without logging into Gmail or cloud services.
          </p>

          <div class="benefit-box">
            <div class="icon-container"><span class="lock-icon">ðŸ”’</span></div>
            <div class="benefit-content">
              <h3 class="benefit-heading">Enhanced Privacy:</h3>
              <ul class="benefit-list">
                <li>No need to log into personal accounts on shared lab computers</li>
                <li>Prevent unauthorized access to your accounts</li>
                <li>Maintain privacy while using public computers</li>
              </ul>
            </div>
          </div>

          <div class="benefit-box">
            <div class="icon-container"><span class="lightning-icon">âš¡</span></div>
            <div class="benefit-content">
              <h3 class="benefit-heading">Quick Transfer:</h3>
              <ul class="benefit-list">
                <li>Instantly upload files from lab computers</li>
                <li>Download to your personal device with a single click</li>
                <li>No complicated setup or account verification</li>
              </ul>
            </div>
          </div>
        </div>

        <div id="statusMessage" class="status-message" style="display: none;"></div>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="status-message {{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form action="/upload" method="post" enctype="multipart/form-data" class="upload-form" id="uploadForm">
          <label for="fileInput" class="custom-file-upload" id="fileLabel">Choose Files</label>
          <input type="file" id="fileInput" name="file" required multiple style="display: none;" />
          <input type="submit" value="Upload" class="submit-button">
        </form>
      </div>

      <div class="right-panel">
        <div class="files-header">
          <h2 class="files-title">Available Files</h2>
          <div class="file-actions-header">
            <button id="selectAllBtn" class="select-button">Select All</button>
            <button id="deselectAllBtn" class="select-button" style="display: none;">Deselect All</button>
            <button id="deleteSelectedBtn" class="delete-selected-button" disabled>Delete Selected</button>
          </div>
        </div>

        <ul class="files-list">
          {% for file in files %}
            <li class="file-item">
              <div class="file-select">
                <input type="checkbox" class="file-checkbox" data-file-id="{{ file.id }}" data-file-name="{{ file.name }}">
              </div>
              <span class="file-name">{{ file.name }}</span>
              <div class="file-actions">
                <a href="/download/{{ file.id }}/{{ file.name }}" class="download-link">Download</a>
                <form action="/delete/{{ file.id }}" method="post" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this file?');">
                  <button type="submit" class="delete-button">Delete</button>
                </form>
              </div>
            </li>
          {% else %}
            <li class="no-files">No files found.</li>
          {% endfor %}
        </ul>
      </div>
      <!-- ======= ORIGINAL CONTENT ENDS HERE ======= -->
    </div>
  </template>

  <!-- Optional: if JS is off, hide page -->
  <noscript>
    <style>body { display: none; }</style>
    <h2>Please enable JavaScript to use this site.</h2>
  </noscript>

  <!-- ======= PIN ENTRY SCRIPT ======= -->
  <script>
    const correctPin = "110104"; // Change your PIN here
    const verified = sessionStorage.getItem("pin_verified");

    if (!verified) {
      const entered = prompt("Enter access PIN:");
      if (entered === correctPin) {
        sessionStorage.setItem("pin_verified", "true");
      } else {
        document.body.innerHTML = "<h2 style='color:red; text-align:center; margin-top:100px;'>Access Denied</h2>";
      }
    }

    if (sessionStorage.getItem("pin_verified") === "true") {
      const template = document.getElementById("pageContent");
      const content = template.content.cloneNode(true);
      document.body.appendChild(content);
    }
  </script>
</body>
